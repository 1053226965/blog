---
layout: post
author: pzc
title: Linux线程与进程
tags: [OS, 线程, 进程]
date: 2021-01-01 00:00 +0800
toc:  true
---

## 线程与进程区别
进程是操作系统资源分配的最小单位，线程是操作系统调度的最小单位。在Linux中，进程与线程的根本区别是共享的资源不一样，进程与子进程间共享代码，或者某些文件描述符，但不共享同一地址空间。线程只需要自己的独立栈和PC等就可以，此外，线程间是共享进程的地址空间的，包括文件描述符等。  
因此，可以得出：
- 创建一个线程比创建一个进程开销更加小
- 线程的上下文切换开销更加小，线程间切换一般只需要切换基本的寄存器就行，进程的话，因为地址空间不一样，需要保存的状态比较多。
- 线程间通信同步更加容易，一般来说使用全局变量，互斥锁，条件变量等就行，进程间则需要使用共享内存、管道、消息队列或者socket的方式

## Linux调度
Linux默认的调度器为CFS（Completely Fair Scheduler），根据vruntime（虚拟的运行时间）来决定运行哪些进程，vruntime = wall_time * ((NICE_0_LOAD * 2^32) / weight)，vruntime跟nice值和weight值有关，nice越大，程序越友好，更愿意让出CPU，weight则相反。  
例如，默认优先级下，一个IO密集型程序和一个CPU密集型程序，明显在一段时间后，后者的vruntime更加大，那么前者的调度优先级就会更加大了。